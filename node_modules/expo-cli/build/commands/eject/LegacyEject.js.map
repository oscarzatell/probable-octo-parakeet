{"version":3,"sources":["../../../src/commands/eject/LegacyEject.ts"],"names":["EXPO_APP_ENTRY","warnIfDependenciesRequireAdditionalSetupAsync","projectRoot","exp","pkg","ConfigUtils","getConfig","skipSDKVersionRequirement","pkgsWithExtraSetup","JsonFile","readAsync","resolveModule","packagesToWarn","Object","keys","dependencies","filter","pkgName","hasOwnProperty","length","plural","log","nested","chalk","yellow","bold","forEach","ejectAsync","options","reactNativeOptionMessage","questions","type","name","message","default","choices","value","short","ejectMethod","nonInteractiveHelp","ejectToBareAsync","green","newLine","packageManager","isUsingYarn","Detach","detachAsync","Error","ensureDependenciesMap","outputMap","key","JSON","stringify","useYarn","npmOrYarn","configPath","configName","findConfigFile","readConfigJsonAsync","configBuffer","fse","readFile","appJson","parse","toString","sdkVersion","Versions","gteSdkVersion","sdkMajorVersionNumber","semver","major","templateSpec","pacote","manifest","e","code","displayName","getAppNamesAsync","expo","entryPoint","writeFile","path","resolve","defaultDependencies","defaultDevDependencies","tempDir","temporary","directory","Exp","extractTemplateAppAsync","copySync","join","devDependencies","read","red","process","exit","scripts","eject","start","ios","android","lteSdkVersion","postinstall","bgYellow","black","combinedDependencies","dependenciesKey","combinedDevDependencies","main","indexjs","grey","remove","PackageManager","createForProject","installAsync","bundleIdentifier","IosWorkspace","setBundleIdentifier","validate","stripDashes","undefined","includes","s","replace"],"mappings":";;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;;;AAaA,MAAMA,cAAc,GAAG,+BAAvB;;AAEA,eAAeC,6CAAf,CAA6DC,WAA7D,EAAiG;AAC/F;AACA,QAAM;AAAEC,IAAAA,GAAF;AAAOC,IAAAA;AAAP,MAAe,MAAMC,WAAW,GAACC,SAAZ,CAAsBJ,WAAtB,EAAmC;AAC5DK,IAAAA,yBAAyB,EAAE;AADiC,GAAnC,CAA3B;AAIA,QAAMC,kBAAkB,GAAG,MAAMC,oBAASC,SAAT,CAC/BL,WAAW,GAACM,aAAZ,CAA0B,8BAA1B,EAA0DT,WAA1D,EAAuEC,GAAvE,CAD+B,CAAjC;AAGA,QAAMS,cAAwB,GAAGC,MAAM,CAACC,IAAP,CAAYV,GAAG,CAACW,YAAhB,EAA8BC,MAA9B,CAAqCC,OAAO,IAC3ET,kBAAkB,CAACU,cAAnB,CAAkCD,OAAlC,CAD+B,CAAjC;;AAIA,MAAIL,cAAc,CAACO,MAAf,KAA0B,CAA9B,EAAiC;AAC/B;AACD;;AAED,MAAIC,MAAM,GAAGR,cAAc,CAACO,MAAf,GAAwB,CAArC;;AACAE,iBAAIC,MAAJ,CAAW,EAAX;;AACAD,iBAAIC,MAAJ,CACEC,iBAAMC,MAAN,CACG,8BAA6BD,iBAAME,IAAN,CAAY,GAAEb,cAAc,CAACO,MAAO,EAApC,CAAuC,WACnEC,MAAM,GAAG,GAAH,GAAS,EAChB,gBAAeA,MAAM,GAAG,EAAH,GAAQ,GAAI,2CAChCA,MAAM,GAAG,GAAH,GAAS,EAChB,oBALH,CADF;;AASAC,iBAAIC,MAAJ,CACEC,iBAAMC,MAAN,CACG,6DACCJ,MAAM,GAAG,gBAAH,GAAsB,cAC7B,sBAHH,CADF;;AAOAC,iBAAIC,MAAJ,CAAW,EAAX;;AACAV,EAAAA,cAAc,CAACc,OAAf,CAAuBT,OAAO,IAAI;AAChCI,mBAAIC,MAAJ,CAAWC,iBAAMC,MAAN,CAAc,KAAID,iBAAME,IAAN,CAAWR,OAAX,CAAoB,KAAIT,kBAAkB,CAACS,OAAD,CAAU,EAAtE,CAAX;AACD,GAFD;;AAGAI,iBAAIC,MAAJ,CAAW,EAAX;AACD;;AAEM,eAAeK,UAAf,CAA0BzB,WAA1B,EAA+C0B,OAA/C,EAA2E;AAChF,QAAM,6CAAN;;AACAP,iBAAIC,MAAJ,CAAW,EAAX;;AAEA,MAAIO,wBAAwB,GAAG,6CAA/B;AAEA,QAAMC,SAAqB,GAAG,CAC5B;AACEC,IAAAA,IAAI,EAAE,MADR;AAEEC,IAAAA,IAAI,EAAE,aAFR;AAGEC,IAAAA,OAAO,EACL,yGAJJ;AAKEC,IAAAA,OAAO,EAAE,MALX;AAMEC,IAAAA,OAAO,EAAE,CACP;AACEH,MAAAA,IAAI,EAAEH,wBADR;AAEEO,MAAAA,KAAK,EAAE,MAFT;AAGEC,MAAAA,KAAK,EAAE;AAHT,KADO,EAMP;AACEL,MAAAA,IAAI,EACF,2FAFJ;AAGEI,MAAAA,KAAK,EAAE,SAHT;AAIEC,MAAAA,KAAK,EAAE;AAJT,KANO,EAYP;AACEL,MAAAA,IAAI,EAAE,0DADR;AAEEI,MAAAA,KAAK,EAAE,QAFT;AAGEC,MAAAA,KAAK,EAAE;AAHT,KAZO;AANX,GAD4B,CAA9B;AA4BA,QAAMC,WAAW,GACfV,OAAO,CAACU,WAAR,IACA,CACE,MAAM,uBAAOR,SAAP,EAAkB;AACtBS,IAAAA,kBAAkB,EAChB;AAFoB,GAAlB,CADR,EAKED,WAPJ;;AASA,MAAIA,WAAW,KAAK,MAApB,EAA4B;AAC1B,UAAME,gBAAgB,CAACtC,WAAD,CAAtB;;AACAmB,mBAAIC,MAAJ,CAAWC,iBAAMkB,KAAN,CAAY,uBAAZ,CAAX;;AACApB,mBAAIqB,OAAJ;;AACArB,mBAAIC,MAAJ,CACG,oGADH;;AAGAD,mBAAIC,MAAJ,CAAW,EAAX;;AACAD,mBAAIC,MAAJ,CAAY,UAAZ;;AACAD,mBAAIC,MAAJ,CAAY,eAAZ;;AACAD,mBAAIC,MAAJ,CAAW,EAAX;;AACAD,mBAAIC,MAAJ,CAAW,+BAAX;;AACAD,mBAAIC,MAAJ,CAAW,EAAX;;AACA,QAAIqB,cAAc,GAAGtC,WAAW,GAACuC,WAAZ,CAAwB1C,WAAxB,IAAuC,MAAvC,GAAgD,KAArE;;AACAmB,mBAAIC,MAAJ,CAAY,KAAIqB,cAAc,KAAK,KAAnB,GAA2B,iBAA3B,GAA+C,cAAe,EAA9E;;AACAtB,mBAAIC,MAAJ,CAAY,KAAIqB,cAAc,KAAK,KAAnB,GAA2B,aAA3B,GAA2C,UAAW,EAAtE;;AACA,UAAM1C,6CAA6C,CAACC,WAAD,CAAnD;AACD,GAjBD,MAiBO,IAAIoC,WAAW,KAAK,SAApB,EAA+B;AACpC,UAAM,6CAAN;AACA,UAAMO,cAAOC,WAAP,CAAmB5C,WAAnB,EAAgC0B,OAAhC,CAAN;AACA,wBAAIL,iBAAMkB,KAAN,CAAY,uBAAZ,CAAJ;AACD,GAJM,MAIA,IAAIH,WAAW,KAAK,QAApB,EAA8B;AACnC;AACA,wBAAI,6DAAJ;AACD,GAHM,MAGA;AACL,UAAM,IAAIS,KAAJ,CACH,8BAA6BT,WAAY,sCADtC,CAAN;AAGD;AACF;;AAED,SAASU,qBAAT,CAA+BjC,YAA/B,EAAmE;AACjE,MAAI,OAAOA,YAAP,KAAwB,QAA5B,EAAsC;AACpC,UAAM,IAAIgC,KAAJ,CAAW,sDAAqD,OAAOhC,YAAa,EAApF,CAAN;AACD;;AAED,QAAMkC,SAA0B,GAAG,EAAnC;AACA,MAAI,CAAClC,YAAL,EAAmB,OAAOkC,SAAP;;AAEnB,OAAK,MAAMC,GAAX,IAAkBrC,MAAM,CAACC,IAAP,CAAYC,YAAZ,CAAlB,EAA6C;AAC3C,UAAMqB,KAAK,GAAGrB,YAAY,CAACmC,GAAD,CAA1B;;AACA,QAAI,OAAOd,KAAP,KAAiB,QAArB,EAA+B;AAC7Ba,MAAAA,SAAS,CAACC,GAAD,CAAT,GAAiBd,KAAjB;AACD,KAFD,MAEO;AACL,YAAM,IAAIW,KAAJ,CACH,wBAAuBG,GAAI,+CAA8CA,GAAI,KAAIC,IAAI,CAACC,SAAL,CAChFhB,KADgF,CAEhF,MAHE,CAAN;AAKD;AACF;;AACD,SAAOa,SAAP;AACD;;AAED,eAAeT,gBAAf,CAAgCtC,WAAhC,EAAoE;AAAA;;AAClE,QAAMmD,OAAO,GAAGhD,WAAW,GAACuC,WAAZ,CAAwB1C,WAAxB,CAAhB;AACA,QAAMoD,SAAS,GAAGD,OAAO,GAAG,MAAH,GAAY,KAArC;AACA,QAAM;AAAEE,IAAAA,UAAF;AAAcC,IAAAA;AAAd,MAA6BnD,WAAW,GAACoD,cAAZ,CAA2BvD,WAA3B,CAAnC;AACA,QAAM;AAAEC,IAAAA,GAAF;AAAOC,IAAAA;AAAP,MAAe,MAAMC,WAAW,GAACqD,mBAAZ,CAAgCxD,WAAhC,CAA3B;AAEA,QAAMyD,YAAY,GAAG,MAAMC,mBAAIC,QAAJ,CAAaN,UAAb,CAA3B;AACA,QAAMO,OAAO,GAAGN,UAAU,KAAK,UAAf,GAA4BL,IAAI,CAACY,KAAL,CAAWJ,YAAY,CAACK,QAAb,EAAX,CAA5B,GAAkE,EAAlF;AAEA;;;;AAGA,MAAI,CAAC7D,GAAG,CAAC8D,UAAT,EAAqB,MAAM,IAAIlB,KAAJ,CAAW,iBAAgBS,UAAW,EAAtC,CAAN;;AAErB,MAAI,CAACU,gBAASC,aAAT,CAAuBhE,GAAvB,EAA4B,QAA5B,CAAL,EAA4C;AAC1C,UAAM,IAAI4C,KAAJ,CAAW,oEAAX,CAAN;AACD,GAhBiE,CAkBlE;;;AACA,MAAIqB,qBAAqB,GAAGC,kBAAOC,KAAP,CAAanE,GAAG,CAAC8D,UAAjB,CAA5B;;AACA,MAAIM,YAAY,GAAG,8BAAe,kCAAiCH,qBAAsB,EAAtE,CAAnB;;AACA,MAAI;AACF,UAAMI,kBAAOC,QAAP,CAAgBF,YAAhB,CAAN;AACD,GAFD,CAEE,OAAOG,CAAP,EAAU;AACV,QAAIA,CAAC,CAACC,IAAF,KAAW,MAAf,EAAuB;AACrB,YAAM,IAAI5B,KAAJ,CACH,qDAAoDqB,qBAAsB,gBADvE,CAAN;AAGD,KAJD,MAIO;AACL,YAAMM,CAAN;AACD;AACF;AAED;;;;;AAGA,MAAI;AAAEE,IAAAA,WAAF;AAAe5C,IAAAA;AAAf,MAAwB,MAAM6C,gBAAgB,CAAC3E,WAAD,CAAlD;AACA4D,EAAAA,OAAO,CAACc,WAAR,GAAsBA,WAAtB;AACAd,EAAAA,OAAO,CAAC9B,IAAR,GAAeA,IAAf;;AAEA,MAAI8B,OAAO,CAACgB,IAAR,CAAaC,UAAb,IAA2BjB,OAAO,CAACgB,IAAR,CAAaC,UAAb,KAA4B/E,cAA3D,EAA2E;AACzE,wBACEuB,iBAAMC,MAAN,CAAc,8DAA6DxB,cAAe,EAA1F,CADF;AAGD,GAJD,MAIO;AACL8D,IAAAA,OAAO,CAACgB,IAAR,CAAaC,UAAb,GAA0B/E,cAA1B;AACD;;AAED,sBAAI,qBAAJ;AACA,QAAM4D,mBAAIoB,SAAJ,CAAcC,gBAAKC,OAAL,CAAa,UAAb,CAAd,EAAwC/B,IAAI,CAACC,SAAL,CAAeU,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAAxC,CAAN;AACA,sBAAIvC,iBAAMkB,KAAN,CAAY,6DAAZ,CAAJ,EAlDkE,CAoDlE;;AACA,MAAI0C,mBAAwB,GAAG,EAA/B;AACA,MAAIC,sBAA2B,GAAG,EAAlC;AAEA;;;;AAGA,MAAI;AACF,UAAMC,OAAO,GAAGC,iBAAUC,SAAV,EAAhB;;AACA,UAAMC,WAAIC,uBAAJ,CAA4BlB,YAA5B,EAA0Cc,OAA1C,EAAmDvB,OAAnD,CAAN;;AACAF,uBAAI8B,QAAJ,CAAaT,gBAAKU,IAAL,CAAUN,OAAV,EAAmB,KAAnB,CAAb,EAAwCJ,gBAAKU,IAAL,CAAUzF,WAAV,EAAuB,KAAvB,CAAxC;;AACA0D,uBAAI8B,QAAJ,CAAaT,gBAAKU,IAAL,CAAUN,OAAV,EAAmB,SAAnB,CAAb,EAA4CJ,gBAAKU,IAAL,CAAUzF,WAAV,EAAuB,SAAvB,CAA5C;;AACA,UAAM;AAAEa,MAAAA,YAAF;AAAgB6E,MAAAA;AAAhB,QAAoCnF,oBAASoF,IAAT,CAAcZ,gBAAKU,IAAL,CAAUN,OAAV,EAAmB,cAAnB,CAAd,CAA1C;;AACAF,IAAAA,mBAAmB,GAAGnC,qBAAqB,CAACjC,YAAD,CAA3C;AACAqE,IAAAA,sBAAsB,GAAGQ,eAAzB;AACA,wBAAI,2CAAJ;AACD,GATD,CASE,OAAOlB,CAAP,EAAU;AACV,wBAAInD,iBAAMuE,GAAN,CAAUpB,CAAC,CAACzC,OAAZ,CAAJ;AACA,wBAAIV,iBAAMuE,GAAN,CAAW,gDAAX,CAAJ;AACA,wBAAIvE,iBAAMC,MAAN,CAAa,gEAAb,CAAJ;AACAuE,IAAAA,OAAO,CAACC,IAAR,CAAa,CAAb;AACD;;AAED,sBAAK,+BAAL;;AACA,MAAI,CAAC5F,GAAG,CAAC6F,OAAT,EAAkB;AAChB7F,IAAAA,GAAG,CAAC6F,OAAJ,GAAc,EAAd;AACD;;AACD,SAAO7F,GAAG,CAAC6F,OAAJ,CAAYC,KAAnB;AACA9F,EAAAA,GAAG,CAAC6F,OAAJ,CAAYE,KAAZ,GAAoB,oBAApB;AACA/F,EAAAA,GAAG,CAAC6F,OAAJ,CAAYG,GAAZ,GAAkB,sBAAlB;AACAhG,EAAAA,GAAG,CAAC6F,OAAJ,CAAYI,OAAZ,GAAsB,0BAAtB,CAlFkE,CAoFlE;;AACA,MAAInC,gBAASoC,aAAT,CAAuBnG,GAAvB,EAA4B,QAA5B,CAAJ,EAA2C;AACzC,QAAIC,GAAG,CAAC6F,OAAJ,CAAYM,WAAhB,EAA6B;AAC3BnG,MAAAA,GAAG,CAAC6F,OAAJ,CAAYM,WAAZ,GAA2B,aAAYnG,GAAG,CAAC6F,OAAJ,CAAYM,WAAY,EAA/D;AACA,0BAAIhF,iBAAMiF,QAAN,CAAeC,KAAf,CAAqB,8DAArB,CAAJ;AACD,KAHD,MAGO;AACLrG,MAAAA,GAAG,CAAC6F,OAAJ,CAAYM,WAAZ,GAA2B,QAA3B;AACD;AACF,GA5FiE,CA8FlE;AACA;AACA;AACA;;;AACA,QAAMG,oBAAqC,GAAG1D,qBAAqB,CAAC,EAClE,GAAGmC,mBAD+D;AAElE,OAAG/E,GAAG,CAACW;AAF2D,GAAD,CAAnE;;AAKA,OAAK,MAAM4F,eAAX,IAA8B,CAAC,OAAD,EAAU,yBAAV,EAAqC,cAArC,CAA9B,EAAoF;AAClFD,IAAAA,oBAAoB,CAACC,eAAD,CAApB,GAAwCxB,mBAAmB,CAACwB,eAAD,CAA3D;AACD;;AACDvG,EAAAA,GAAG,CAACW,YAAJ,GAAmB2F,oBAAnB;AAEA,QAAME,uBAAwC,GAAG5D,qBAAqB,CAAC,EACrE,GAAGoC,sBADkE;AAErE,OAAGhF,GAAG,CAACwF;AAF8D,GAAD,CAAtE,CA5GkE,CAiHlE;;AACA,MAAI1B,gBAASoC,aAAT,CAAuBnG,GAAvB,EAA4B,QAA5B,CAAJ,EAA2C;AACzCyG,IAAAA,uBAAuB,CAAC,UAAD,CAAvB,GAAsCxB,sBAAsB,CAAC,UAAD,CAA5D;AACD;;AAEDhF,EAAAA,GAAG,CAACwF,eAAJ,GAAsBgB,uBAAtB;AACA,QAAMhD,mBAAIoB,SAAJ,CAAcC,gBAAKC,OAAL,CAAa,cAAb,CAAd,EAA4C/B,IAAI,CAACC,SAAL,CAAehD,GAAf,EAAoB,IAApB,EAA0B,CAA1B,CAA5C,CAAN;AACA,sBAAImB,iBAAMkB,KAAN,CAAY,kCAAZ,CAAJ;AAEA,sBAAK,uBAAL;;AACA,MAAIrC,GAAG,CAACyG,IAAJ,KAAa7G,cAAjB,EAAiC;AAC/B,wBACEuB,iBAAMC,MAAN,CACG,oBAAmBpB,GAAG,CAACyG,IAAK,0DAD/B,CADF;AAKD;;AACD,SAAOzG,GAAG,CAACyG,IAAX;AACA,QAAMjD,mBAAIoB,SAAJ,CAAcC,gBAAKC,OAAL,CAAa,cAAb,CAAd,EAA4C/B,IAAI,CAACC,SAAL,CAAehD,GAAf,EAAoB,IAApB,EAA0B,CAA1B,CAA5C,CAAN;AAEA,QAAM0G,OAAO,GAAI;;;iCAGchD,OAAO,CAAC9B,IAAK;;;;gCAId8B,OAAO,CAAC9B,IAAK;;CAP3C;AAUA,QAAM4B,mBAAIoB,SAAJ,CAAcC,gBAAKC,OAAL,CAAa,UAAb,CAAd,EAAwC4B,OAAxC,CAAN;AACA,sBAAIvF,iBAAMkB,KAAN,CAAY,yBAAZ,CAAJ;AAEA,sBACElB,iBAAMwF,IAAN,CACG,qBAAoBzD,SAAU,6GADjC,CADF;AAMA,sBAAI,0BAAJ;AACA,QAAMM,mBAAIoD,MAAJ,CAAW,cAAX,CAAN;AAEA,sBAAI,4BAAJ;AACA,QAAMrE,cAAc,GAAGsE,cAAc,GAACC,gBAAf,CAAgChH,WAAhC,EAA6C;AAAEmB,IAAAA,GAAG,EAAHA;AAAF,GAA7C,CAAvB;AACA,QAAMsB,cAAc,CAACwE,YAAf,EAAN,CA7JkE,CA+JlE;AACA;;AACA,kBAAIhH,GAAG,CAACiG,GAAR,6CAAI,SAASgB,gBAAb,EAA+B;AAAA;;AAC7BC,wBAAaC,mBAAb,CAAiCpH,WAAjC,eAA8CC,GAAG,CAACiG,GAAlD,8CAA8C,UAASgB,gBAAvD;AACD;;AAED/F,iBAAIqB,OAAJ;AACD;AAED;;;;;;;;AAMA,eAAemC,gBAAf,CACE3E,WADF,EAEkD;AAChD,QAAM;AAAEqD,IAAAA,UAAF;AAAcC,IAAAA;AAAd,MAA6BnD,WAAW,GAACoD,cAAZ,CAA2BvD,WAA3B,CAAnC;AACA,QAAM;AAAEC,IAAAA,GAAF;AAAOC,IAAAA;AAAP,MAAe,MAAMC,WAAW,GAACqD,mBAAZ,CAAgCxD,WAAhC,CAA3B;AAEA,QAAMyD,YAAY,GAAG,MAAMC,mBAAIC,QAAJ,CAAaN,UAAb,CAA3B;AACA,QAAMO,OAAO,GAAGN,UAAU,KAAK,UAAf,GAA4BL,IAAI,CAACY,KAAL,CAAWJ,YAAY,CAACK,QAAb,EAAX,CAA5B,GAAkE,EAAlF;AAEA,MAAI;AAAEY,IAAAA,WAAF;AAAe5C,IAAAA;AAAf,MAAwB8B,OAA5B;;AACA,MAAI,CAACc,WAAD,IAAgB,CAAC5C,IAArB,EAA2B;AACzB,wBAAI,iFAAJ;AACA,KAAC;AAAE4C,MAAAA,WAAF;AAAe5C,MAAAA;AAAf,QAAwB,MAAM,uBAC7B,CACE;AACEA,MAAAA,IAAI,EAAE,aADR;AAEEC,MAAAA,OAAO,EAAE,yDAFX;AAGEC,MAAAA,OAAO,EAAEF,IAAI,IAAI7B,GAAG,CAAC6B,IAHvB;;AAIEuF,MAAAA,QAAQ,CAAC;AAAEpG,QAAAA;AAAF,OAAD,EAAoD;AAC1D,eAAOA,MAAM,GAAG,IAAH,GAAU,mCAAvB;AACD;;AANH,KADF,EASE;AACEa,MAAAA,IAAI,EAAE,MADR;AAEEC,MAAAA,OAAO,EAAE,+DAFX;AAGEC,MAAAA,OAAO,EAAE9B,GAAG,CAAC4B,IAAJ,GAAWwF,WAAW,CAACpH,GAAG,CAAC4B,IAAL,CAAtB,GAAmCyF,SAH9C;;AAIEF,MAAAA,QAAQ,CAACnF,KAAD,EAA+C;AACrD,YAAIA,KAAK,CAACjB,MAAN,KAAiB,CAArB,EAAwB;AACtB,iBAAO,+BAAP;AACD,SAFD,MAEO,IAAIiB,KAAK,CAACsF,QAAN,CAAe,GAAf,KAAuBtF,KAAK,CAACsF,QAAN,CAAe,GAAf,CAA3B,EAAgD;AACrD,iBAAO,gDAAP;AACD;;AACD,eAAO,IAAP;AACD;;AAXH,KATF,CAD6B,EAwB7B;AACEnF,MAAAA,kBAAkB,EAAE;AADtB,KAxB6B,CAA/B;AA4BD;;AAED,SAAO;AAAEqC,IAAAA,WAAF;AAAe5C,IAAAA;AAAf,GAAP;AACD;;AAEM,SAASwF,WAAT,CAAqBG,CAArB,EAAwC;AAC7C,SAAOA,CAAC,CAACC,OAAF,CAAU,OAAV,EAAmB,EAAnB,CAAP;AACD","sourcesContent":["import * as ConfigUtils from '@expo/config';\nimport JsonFile from '@expo/json-file';\nimport { Detach, Exp, IosWorkspace, Versions } from '@expo/xdl';\nimport chalk from 'chalk';\nimport fse from 'fs-extra';\nimport npmPackageArg from 'npm-package-arg';\nimport pacote from 'pacote';\nimport path from 'path';\nimport semver from 'semver';\nimport temporary from 'tempy';\n\nimport * as PackageManager from '@expo/package-manager';\nimport { loginOrRegisterIfLoggedOut } from '../../accounts';\nimport log from '../../log';\nimport prompt, { Question } from '../../prompt';\nimport { validateGitStatusAsync } from '../utils/ProjectUtils';\n\ntype ValidationErrorMessage = string;\n\ntype DependenciesMap = { [key: string]: string | number };\n\nexport type EjectAsyncOptions = {\n  ejectMethod: 'bare' | 'expokit' | 'cancel';\n  verbose?: boolean;\n  force?: boolean;\n  packageManager?: 'npm' | 'yarn';\n};\n\nconst EXPO_APP_ENTRY = 'node_modules/expo/AppEntry.js';\n\nasync function warnIfDependenciesRequireAdditionalSetupAsync(projectRoot: string): Promise<void> {\n  // We just need the custom `nodeModulesPath` from the config.\n  const { exp, pkg } = await ConfigUtils.getConfig(projectRoot, {\n    skipSDKVersionRequirement: true,\n  });\n\n  const pkgsWithExtraSetup = await JsonFile.readAsync(\n    ConfigUtils.resolveModule('expo/requiresExtraSetup.json', projectRoot, exp)\n  );\n  const packagesToWarn: string[] = Object.keys(pkg.dependencies).filter(pkgName =>\n    pkgsWithExtraSetup.hasOwnProperty(pkgName)\n  );\n\n  if (packagesToWarn.length === 0) {\n    return;\n  }\n\n  let plural = packagesToWarn.length > 1;\n  log.nested('');\n  log.nested(\n    chalk.yellow(\n      `Warning: your app includes ${chalk.bold(`${packagesToWarn.length}`)} package${\n        plural ? 's' : ''\n      } that require${plural ? '' : 's'} additional setup. See the following URL${\n        plural ? 's' : ''\n      } for instructions.`\n    )\n  );\n  log.nested(\n    chalk.yellow(\n      `Your app may not build/run until the additional setup for ${\n        plural ? 'these packages' : 'this package'\n      } has been completed.`\n    )\n  );\n  log.nested('');\n  packagesToWarn.forEach(pkgName => {\n    log.nested(chalk.yellow(`- ${chalk.bold(pkgName)}: ${pkgsWithExtraSetup[pkgName]}`));\n  });\n  log.nested('');\n}\n\nexport async function ejectAsync(projectRoot: string, options: EjectAsyncOptions) {\n  await validateGitStatusAsync();\n  log.nested('');\n\n  let reactNativeOptionMessage = \"Bare: I'd like a bare React Native project.\";\n\n  const questions: Question[] = [\n    {\n      type: 'list',\n      name: 'ejectMethod',\n      message:\n        'How would you like to eject your app?\\n  Read more: https://docs.expo.io/versions/latest/expokit/eject/',\n      default: 'bare',\n      choices: [\n        {\n          name: reactNativeOptionMessage,\n          value: 'bare',\n          short: 'Bare',\n        },\n        {\n          name:\n            \"ExpoKit: I'll create or log in with an Expo account to use React Native and the Expo SDK.\",\n          value: 'expokit',\n          short: 'ExpoKit',\n        },\n        {\n          name: \"Cancel: I'll continue with my current project structure.\",\n          value: 'cancel',\n          short: 'cancel',\n        },\n      ],\n    },\n  ];\n\n  const ejectMethod =\n    options.ejectMethod ||\n    (\n      await prompt(questions, {\n        nonInteractiveHelp:\n          'Please specify eject method (bare, expokit) with the --eject-method option.',\n      })\n    ).ejectMethod;\n\n  if (ejectMethod === 'bare') {\n    await ejectToBareAsync(projectRoot);\n    log.nested(chalk.green('Ejected successfully!'));\n    log.newLine();\n    log.nested(\n      `Before running your app on iOS, make sure you have CocoaPods installed and initialize the project:`\n    );\n    log.nested('');\n    log.nested(`  cd ios`);\n    log.nested(`  pod install`);\n    log.nested('');\n    log.nested('Then you can run the project:');\n    log.nested('');\n    let packageManager = ConfigUtils.isUsingYarn(projectRoot) ? 'yarn' : 'npm';\n    log.nested(`  ${packageManager === 'npm' ? 'npm run android' : 'yarn android'}`);\n    log.nested(`  ${packageManager === 'npm' ? 'npm run ios' : 'yarn ios'}`);\n    await warnIfDependenciesRequireAdditionalSetupAsync(projectRoot);\n  } else if (ejectMethod === 'expokit') {\n    await loginOrRegisterIfLoggedOut();\n    await Detach.detachAsync(projectRoot, options);\n    log(chalk.green('Ejected successfully!'));\n  } else if (ejectMethod === 'cancel') {\n    // we don't want to print the survey for cancellations\n    log('OK! If you change your mind you can run this command again.');\n  } else {\n    throw new Error(\n      `Unrecognized eject method \"${ejectMethod}\". Valid options are: bare, expokit.`\n    );\n  }\n}\n\nfunction ensureDependenciesMap(dependencies: any): DependenciesMap {\n  if (typeof dependencies !== 'object') {\n    throw new Error(`Dependency map is invalid, expected object but got ${typeof dependencies}`);\n  }\n\n  const outputMap: DependenciesMap = {};\n  if (!dependencies) return outputMap;\n\n  for (const key of Object.keys(dependencies)) {\n    const value = dependencies[key];\n    if (typeof value === 'string') {\n      outputMap[key] = value;\n    } else {\n      throw new Error(\n        `Dependency for key \\`${key}\\` should be a \\`string\\`, instead got: \\`{ ${key}: ${JSON.stringify(\n          value\n        )} }\\``\n      );\n    }\n  }\n  return outputMap;\n}\n\nasync function ejectToBareAsync(projectRoot: string): Promise<void> {\n  const useYarn = ConfigUtils.isUsingYarn(projectRoot);\n  const npmOrYarn = useYarn ? 'yarn' : 'npm';\n  const { configPath, configName } = ConfigUtils.findConfigFile(projectRoot);\n  const { exp, pkg } = await ConfigUtils.readConfigJsonAsync(projectRoot);\n\n  const configBuffer = await fse.readFile(configPath);\n  const appJson = configName === 'app.json' ? JSON.parse(configBuffer.toString()) : {};\n\n  /**\n   * Perform validations\n   */\n  if (!exp.sdkVersion) throw new Error(`Couldn't read ${configName}`);\n\n  if (!Versions.gteSdkVersion(exp, '34.0.0')) {\n    throw new Error(`Ejecting to a bare project is only available for SDK 34 and higher`);\n  }\n\n  // Validate that the template exists\n  let sdkMajorVersionNumber = semver.major(exp.sdkVersion);\n  let templateSpec = npmPackageArg(`expo-template-bare-minimum@sdk-${sdkMajorVersionNumber}`);\n  try {\n    await pacote.manifest(templateSpec);\n  } catch (e) {\n    if (e.code === 'E404') {\n      throw new Error(\n        `Unable to eject because an eject template for SDK ${sdkMajorVersionNumber} was not found`\n      );\n    } else {\n      throw e;\n    }\n  }\n\n  /**\n   * Customize app.json\n   */\n  let { displayName, name } = await getAppNamesAsync(projectRoot);\n  appJson.displayName = displayName;\n  appJson.name = name;\n\n  if (appJson.expo.entryPoint && appJson.expo.entryPoint !== EXPO_APP_ENTRY) {\n    log(\n      chalk.yellow(`expo.entryPoint is already configured, we recommend using \"${EXPO_APP_ENTRY}`)\n    );\n  } else {\n    appJson.expo.entryPoint = EXPO_APP_ENTRY;\n  }\n\n  log('Writing app.json...');\n  await fse.writeFile(path.resolve('app.json'), JSON.stringify(appJson, null, 2));\n  log(chalk.green('Wrote to app.json, please update it manually in the future.'));\n\n  // This is validated later...\n  let defaultDependencies: any = {};\n  let defaultDevDependencies: any = {};\n\n  /**\n   * Extract the template and copy it over\n   */\n  try {\n    const tempDir = temporary.directory();\n    await Exp.extractTemplateAppAsync(templateSpec, tempDir, appJson);\n    fse.copySync(path.join(tempDir, 'ios'), path.join(projectRoot, 'ios'));\n    fse.copySync(path.join(tempDir, 'android'), path.join(projectRoot, 'android'));\n    const { dependencies, devDependencies } = JsonFile.read(path.join(tempDir, 'package.json'));\n    defaultDependencies = ensureDependenciesMap(dependencies);\n    defaultDevDependencies = devDependencies;\n    log('Successfully copied template native code.');\n  } catch (e) {\n    log(chalk.red(e.message));\n    log(chalk.red(`Eject failed, see above output for any issues.`));\n    log(chalk.yellow('You may want to delete the `ios` and/or `android` directories.'));\n    process.exit(1);\n  }\n\n  log(`Updating your package.json...`);\n  if (!pkg.scripts) {\n    pkg.scripts = {};\n  }\n  delete pkg.scripts.eject;\n  pkg.scripts.start = 'react-native start';\n  pkg.scripts.ios = 'react-native run-ios';\n  pkg.scripts.android = 'react-native run-android';\n\n  // Jetifier is only needed for SDK 34 & 35\n  if (Versions.lteSdkVersion(exp, '35.0.0')) {\n    if (pkg.scripts.postinstall) {\n      pkg.scripts.postinstall = `jetify && ${pkg.scripts.postinstall}`;\n      log(chalk.bgYellow.black('jetifier has been added to your existing postinstall script.'));\n    } else {\n      pkg.scripts.postinstall = `jetify`;\n    }\n  }\n\n  // The template may have some dependencies beyond react/react-native/react-native-unimodules,\n  // for example RNGH and Reanimated. We should prefer the version that is already being used\n  // in the project for those, but swap the react/react-native/react-native-unimodules versions\n  // with the ones in the template.\n  const combinedDependencies: DependenciesMap = ensureDependenciesMap({\n    ...defaultDependencies,\n    ...pkg.dependencies,\n  });\n\n  for (const dependenciesKey of ['react', 'react-native-unimodules', 'react-native']) {\n    combinedDependencies[dependenciesKey] = defaultDependencies[dependenciesKey];\n  }\n  pkg.dependencies = combinedDependencies;\n\n  const combinedDevDependencies: DependenciesMap = ensureDependenciesMap({\n    ...defaultDevDependencies,\n    ...pkg.devDependencies,\n  });\n\n  // Jetifier is only needed for SDK 34 & 35\n  if (Versions.lteSdkVersion(exp, '35.0.0')) {\n    combinedDevDependencies['jetifier'] = defaultDevDependencies['jetifier'];\n  }\n\n  pkg.devDependencies = combinedDevDependencies;\n  await fse.writeFile(path.resolve('package.json'), JSON.stringify(pkg, null, 2));\n  log(chalk.green('Your package.json is up to date!'));\n\n  log(`Adding entry point...`);\n  if (pkg.main !== EXPO_APP_ENTRY) {\n    log(\n      chalk.yellow(\n        `Removing \"main\": ${pkg.main} from package.json. We recommend using index.js instead.`\n      )\n    );\n  }\n  delete pkg.main;\n  await fse.writeFile(path.resolve('package.json'), JSON.stringify(pkg, null, 2));\n\n  const indexjs = `import { AppRegistry, Platform } from 'react-native';\nimport App from './App';\n\nAppRegistry.registerComponent('${appJson.name}', () => App);\n\nif (Platform.OS === 'web') {\n  const rootTag = document.getElementById('root') || document.getElementById('main');\n  AppRegistry.runApplication('${appJson.name}', { rootTag });\n}\n`;\n  await fse.writeFile(path.resolve('index.js'), indexjs);\n  log(chalk.green('Added new entry points!'));\n\n  log(\n    chalk.grey(\n      `Note that using \\`${npmOrYarn} start\\` will now require you to run Xcode and/or Android Studio to build the native code for your project.`\n    )\n  );\n\n  log('Removing node_modules...');\n  await fse.remove('node_modules');\n\n  log('Installing new packages...');\n  const packageManager = PackageManager.createForProject(projectRoot, { log });\n  await packageManager.installAsync();\n\n  // --Apply app config to iOS and Android projects here--\n  // If the bundleIdentifier exists then set it on the project\n  if (exp.ios?.bundleIdentifier) {\n    IosWorkspace.setBundleIdentifier(projectRoot, exp.ios?.bundleIdentifier);\n  }\n\n  log.newLine();\n}\n\n/**\n * Returns a name that adheres to Xcode and Android naming conventions.\n *\n * - package name: https://docs.oracle.com/javase/tutorial/java/package/namingpkgs.html\n * @param projectRoot\n */\nasync function getAppNamesAsync(\n  projectRoot: string\n): Promise<{ displayName: string; name: string }> {\n  const { configPath, configName } = ConfigUtils.findConfigFile(projectRoot);\n  const { exp, pkg } = await ConfigUtils.readConfigJsonAsync(projectRoot);\n\n  const configBuffer = await fse.readFile(configPath);\n  const appJson = configName === 'app.json' ? JSON.parse(configBuffer.toString()) : {};\n\n  let { displayName, name } = appJson;\n  if (!displayName || !name) {\n    log(\"We have a couple of questions to ask you about how you'd like to name your app:\");\n    ({ displayName, name } = await prompt(\n      [\n        {\n          name: 'displayName',\n          message: \"What should your app appear as on a user's home screen?\",\n          default: name || exp.name,\n          validate({ length }: string): true | ValidationErrorMessage {\n            return length ? true : 'App display name cannot be empty.';\n          },\n        },\n        {\n          name: 'name',\n          message: 'What should your Android Studio and Xcode projects be called?',\n          default: pkg.name ? stripDashes(pkg.name) : undefined,\n          validate(value: string): true | ValidationErrorMessage {\n            if (value.length === 0) {\n              return 'Project name cannot be empty.';\n            } else if (value.includes('-') || value.includes(' ')) {\n              return 'Project name cannot contain hyphens or spaces.';\n            }\n            return true;\n          },\n        },\n      ],\n      {\n        nonInteractiveHelp: 'Please specify \"displayName\" and \"name\" in app.json.',\n      }\n    ));\n  }\n\n  return { displayName, name };\n}\n\nexport function stripDashes(s: string): string {\n  return s.replace(/\\s|-/g, '');\n}\n"],"file":"LegacyEject.js"}